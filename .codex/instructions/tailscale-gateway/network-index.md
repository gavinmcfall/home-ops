# `apps/network` Index

High-level understanding of everything running under `kubernetes/apps/network`, with emphasis on how each component participates in ingress, DNS, or routing today.

| Directory | Purpose & Key Bits | Exposure / Dependencies | Notes for Gateway Work |
| --- | --- | --- | --- |
| `namespace.yaml` | Declares the shared `network` namespace. | Consumed by every Flux Kustomization in this tree. | Nothing to change, but all new gateway assets should continue to land here. |
| `cloudflared` | bjw `app-template` wrapping `cloudflare/cloudflared` tunnel with config map + secret. Sends `*.${SECRET_DOMAIN}` traffic to `ingress-nginx-external` or `envoy-internal`. | Depends on `external-dns` secret, mounts `config` that points at ingress controllers. | When ingress controllers disappear, update `configs/config.yaml` so tunnel targets Envoy Gateways instead. |
| `cloudflare-ddns` | Single container app hitting Cloudflare API to update `ipv4.nerdz.cloud`. Includes HTTP ingress (class `internal`). | Requires `cloudflare-ddns-secret`. Uses ingress/host `ddns.nerdz.cloud`. | Needs HTTPRoute parented to the internal gateway; no Tailscale impact. |
| `echo-server` | Debug echo app. Exposes metrics & HTTP ingress with class `external` + Cloudflare DNS annotation. | Uses ingress host `echo-server.${SECRET_DOMAIN}` via external nginx. | Convert to HTTPRoute on Envoy external gateway; keep as test target when building tailscale entrypoint. |
| `envoy-gateway` | HelmRelease for Envoy Gateway controller plus manifests for `external` and `internal` GatewayClasses, Gateways, EnvoyProxy specs, TLS certs, traffic policies, monitors. | External LB IP `10.90.3.201`, internal `10.90.3.202`. TLS secret `envoy-gateway-${SECRET_DOMAIN/./-}-tls`. | Foundation for HTTPRoute migration. We will add a third stack (`envoy-tailscale`) here to terminate tailnet traffic. |
| `external-dns` | Cloudflare provider, watches `Ingress`, `Gateway`, and `HTTPRoute`. Tied to `external` gateway via args (`--gateway-name=external`). | Needs `external-dns-secret`. Publishes `*.${SECRET_DOMAIN}` to Cloudflare. | No change for tailnet, but keep in mind it will try to read every HTTPRoute unless `external-dns.alpha.kubernetes.io/exclude` is set. |
| `external-dns-unifi` | Webhook-based external-dns instance writing to on-prem Unifi controller for `nerdz.cloud`. | Uses dedicated secret + webhook container. | Strictly LAN DNS; doesn’t need Envoy but the ingress removal work in `external-services` depends on it. |
| `external-services` | Bare Services + EndpointSlices + Ingresses that front physical boxes (Proxmox, TrueNAS, Unifi, Voron) through the internal ingress class. | Each file pins `external-dns` target `internal.${SECRET_DOMAIN}` and points at static IPs from secrets. | Move these to Envoy HTTPRoutes + (if desired) lightweight Helm chart; evaluate if any also need Tailscale exposure. |
| `ingress-nginx` | Both internal and external ingress-nginx deployments + TLS cert manifests. | Provide ingress classes `internal` (default) and `external`. | Ultimately deprecated once HTTPRoutes + Envoy cover all workloads. Keep until final cutover for safety. |
| `k8s-gateway` | coredns-based gateway chart (port 53 LoadBalancer `10.90.3.200`) that synthesizes DNS records from Kubernetes Services/Ingresses. | Offers quick internal DNS for `${SECRET_DOMAIN}`. | Validate how this interacts with Envoy hostnames post-migration, especially if internal DNS should resolve to Envoy IPs. |
| `multus` | HelmRelease for Multus CNI plus `NetworkAttachmentDefinition` for IoT VLAN. | Enables pods to attach to `bond0.107`. | Not directly tied to ingress, but ensure Envoy pods stay on primary network. |
| `oauth2-proxy` | bjw helm chart running oauth2-proxy with ingress class `external` at `/oauth2`. | Protects apps via `external` NGINX today. | Needs Envoy HTTPRoute; consider consolidating auth story for Envoy listeners. Tailscale out-of-scope. |
| `tailscale` | Flux Kustomization that installs the Tailscale operator (CRDs + deployment). Operator config enables API server proxy and logs. | Provides `IngressClass tailscale` implicitly plus ability to expose Services via annotations. | This is the piece we’ll reconfigure to front Envoy instead of individual app ingresses. |
